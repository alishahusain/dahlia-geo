---
title: "grouphw1"
author: "Billy Wang"
date: "January 25, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Intro

Below we see population data gathered from the National Bureau of Statistics of China. Formatting of the original raw file was odd & difficult to work with, so I modified it and cleaned it in a separate file. Below you will see the Gross Domestic Populations of 
the first 10 provinces, so it matches up well with the Enterprise/Output data, as well as a cut year range from 2000 to 2017. 

## Loading Data 
This is how to load data into R and how to convert it 
```{r first, echo=FALSE}
library(tidyverse)
pop1 = read.csv("GrossDomPop_byProvince.csv")
pop2=as_tibble(pop1)
plot(pop2$Year, pop2$Beijing_GrossDomesticPopulation, main="Population in Beijing Last 10 Years (in 10,000)", pch=19)
plot(pop2$Year, pop2$Tianjin_GrossDomesticPopulation, main="Population in Tianjin Last 10 Years (in 10,000)", pch=19)
```


Here we see population graphs for both the province of Beijing as well as Tianjin. Notice how they similarly mark against one another in a logarithmic fashion. As previously mentioned, the timeframe of 2000 to 2017 was chosen purpusely as you can see from around 2000 to ~2010, China was experiencing huge population growth, to the point of exponential codification. However, post 2010 you see a sharp decline in the growth rate as exemplified below, taken as well from the Natural Bureau of of Statistics of China, which causes the progression from exponential growth to a more modest logarithmic. 
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r second, echo=FALSE}
growthRate = read.csv("GrowthRate.csv")
growthRate2=as_tibble(growthRate)
natural_growthRate <- growthRate2[3,]
years <- c("1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009", "2010","2011","2012","2013","2014","2015","2016","2017")
plot(years, natural_growthRate, main="Natural Growth Rate of Chinese Citizens Totaled in %", pch=19)
```

Next, we combine both the Enterprise/Output data, as well as the new Population Data, to check for hidden variables. We will normalize the Enterpise data to the Gross Domestic Population variable to limit the role of external factors and try and derive a relationship from it. Below you will see a function that takes in the province names of all ten listed and calculates it's enterprise to population ratio, followed by a line plot to add contour to the pattern. It runs through Beijing then Tianjin then Hebei, etc so you the viewer can easily visually compare Enterprise/Population ratios from the top down. 
```{r third, echo=FALSE}
pop1 = read.csv("GrossDomPop_byProvince.csv")
pop2=as_tibble(pop1)
object1 = read.csv("China_EO_49to17.csv")
object2=as_tibble(object1)
by_year_desc <- object2[order(-object2$Year),]
mergedTable <- merge(by_year_desc, pop2, by.x="Year")
province2000 <- function(province) {
  output <- filter(mergedTable, Year >= '2000') %>% select(Year,paste0(province,"_Enterprise"), paste0(province,"_GrossDomesticPopulation"))
  output2 <- mutate(output, ratio = output[,2]/output[,3])
  return(output2)
}
beijingEnterprise_Pop <- province2000("Beijing")
print(beijingEnterprise_Pop)
plot(beijingEnterprise_Pop$Year, beijingEnterprise_Pop$ratio, main="Enterprise/Population Ratio in Beijing Last 10 Years", pch=19)


provinceList <- c("Beijing", "Tianjin", "Hebei", "Shanxi", "InnerMongolia", "Liaoning", "Jilin", "Heilongjiang", "Shanghai")
bigMerge <- function(names) {
  bigMergedTable <- filter(mergedTable, Year >= '2000')
  for (i in 1: length(names)) {
     currentEnter <- bigMergedTable %>% select(paste0(names[i],"_Enterprise"))
     currentPop <- bigMergedTable %>% select(paste0(names[i], "_GrossDomesticPopulation"))
     print(currentEnter/currentPop)
     print(ggplot(province2000(names[i]), aes(x = Year, y = ratio)) + 
      geom_line(color = "#660066") +
      geom_point(color = "#FF8000") +
      labs(x = "Year", y = "Ratio"))
  }
  return (bigMergedTable)
}
finalTable <- bigMerge(provinceList)
```
